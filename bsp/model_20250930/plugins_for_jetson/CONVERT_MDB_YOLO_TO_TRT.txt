================================================================================
           ğŸš€ å°† MDB-YOLO è½¬æ¢ä¸º TensorRT å¼•æ“
================================================================================

é—®é¢˜åˆ†æ:
âœ… æ’ä»¶åŠ è½½æˆåŠŸäº†
âŒ ä½†æ˜¯ bestfp16.trt æ˜¯åŸå§‹ YOLOv8 çš„å¼•æ“ï¼Œä¸åŒ…å« MDB-YOLO çš„è‡ªå®šä¹‰å±‚

è§£å†³æ–¹æ¡ˆ:
éœ€è¦ä» MDB-YOLO.pt ç”Ÿæˆæ–°çš„ TensorRT å¼•æ“

================================================================================
                    æ­¥éª¤ 1: å¯¼å‡º ONNXï¼ˆWindows ä¸Šï¼‰
================================================================================

æ£€æŸ¥ model_shift.py æ˜¯å¦æ­£ç¡®:
-----------------------------------
from ultralytics import YOLO

model = YOLO("MDB-YOLO.pt")

# å¿…é¡»ä½¿ç”¨ opset=16 (å› ä¸º DySample éœ€è¦ grid_sampler)
output = model.export(format="onnx", simplify=True, dynamic=False, opset=16)
-----------------------------------

è¿è¡Œå¯¼å‡º:
-----------------------------------
cd E:\BaiduNetdiskDownload\Network-YOLOv\ultralytics-8.2.0_test\bsp\model_20250930
E:\virtual\yolotongyong1\python.exe model_shift.py
-----------------------------------

é¢„æœŸè¾“å‡º:
MDB-YOLO.onnx

================================================================================
                    æ­¥éª¤ 2: ä¼ è¾“ ONNX åˆ° Jetson
================================================================================

-----------------------------------
cd E:\BaiduNetdiskDownload\Network-YOLOv\ultralytics-8.2.0_test\bsp\model_20250930
scp MDB-YOLO.onnx aiot@192.168.31.220:~/tensorrt-alpha/yolov8/
-----------------------------------

================================================================================
                    æ­¥éª¤ 3: åœ¨ Jetson ä¸Šè½¬æ¢ä¸º TRTï¼ˆä¸¤ç§æ–¹æ³•ï¼‰
================================================================================

æ–¹æ³• 1: ä½¿ç”¨ app_yolov8 è‡ªåŠ¨è½¬æ¢ (æ¨è)
-----------------------------------
cd ~/tensorrt-alpha/yolov8/build

# ç¬¬ä¸€æ¬¡è¿è¡Œä¼šè‡ªåŠ¨å°† .onnx è½¬æ¢ä¸º .trt
./app_yolov8 \
  --model=../MDB-YOLO.onnx \
  --size=640 \
  --img=../../data/taro/8.jpg \
  --show \
  --savePath=../

# app_yolov8 ä¼šè‡ªåŠ¨æ„å»ºå¼•æ“å¹¶ä¿å­˜ä¸º MDB-YOLO.trt
# åç»­å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ MDB-YOLO.trt äº†
-----------------------------------

æ–¹æ³• 2: ä½¿ç”¨ trtexec æ‰‹åŠ¨è½¬æ¢
-----------------------------------
cd ~/tensorrt-alpha/yolov8

# FP32
/usr/src/tensorrt/bin/trtexec \
  --onnx=MDB-YOLO.onnx \
  --saveEngine=MDB-YOLO_fp32.trt \
  --plugins=/home/aiot/tensorrt-alpha/mdb_yolo/plugins/build/libmdb_yolo_plugins.so

# FP16 (æ›´å¿«)
/usr/src/tensorrt/bin/trtexec \
  --onnx=MDB-YOLO.onnx \
  --saveEngine=MDB-YOLO_fp16.trt \
  --fp16 \
  --plugins=/home/aiot/tensorrt-alpha/mdb_yolo/plugins/build/libmdb_yolo_plugins.so
-----------------------------------

================================================================================
                    æ­¥éª¤ 4: æµ‹è¯• MDB-YOLO TensorRT å¼•æ“
================================================================================

-----------------------------------
cd ~/tensorrt-alpha/yolov8/build

# ä½¿ç”¨æ–°ç”Ÿæˆçš„ TRT å¼•æ“
./app_yolov8 \
  --model=../MDB-YOLO_fp16.trt \
  --size=640 \
  --img=../../data/taro/8.jpg \
  --show \
  --savePath=../
-----------------------------------

é¢„æœŸæˆåŠŸè¾“å‡º:
[I] MDB-YOLO custom plugins (DySample, C2f_EMA, ODConv, BiFPN) loaded successfully!
[I] model_path = ../MDB-YOLO_fp16.trt
[I] Loaded engine size: XX MiB
preprocess time = ...
infer time = ...
postprocess time = ...

================================================================================
                    âš ï¸ æ³¨æ„äº‹é¡¹
================================================================================

1. ONNX å¯¼å‡ºå¿…é¡»ä½¿ç”¨ opset=16
   - DySample å±‚éœ€è¦ grid_sampler ç®—å­
   - opset < 16 ä¼šå¯¼è‡´å¯¼å‡ºå¤±è´¥

2. æ’ä»¶å¿…é¡»æ­£ç¡®åŠ è½½
   - ç¡®ä¿ app_yolov8.cpp ä¸­çš„ dlopen ä»£ç å­˜åœ¨
   - ç¡®ä¿ libmdb_yolo_plugins.so è·¯å¾„æ­£ç¡®

3. TensorRT ç‰ˆæœ¬å…¼å®¹æ€§
   - åœ¨åŒä¸€å° Jetson ä¸Šæ„å»ºå’Œè¿è¡Œå¼•æ“
   - ä¸è¦åœ¨ä¸åŒè®¾å¤‡é—´ä¼ è¾“ .trt æ–‡ä»¶

4. ç¬¬ä¸€æ¬¡è½¬æ¢ä¼šæ¯”è¾ƒæ…¢
   - TensorRT éœ€è¦ä¼˜åŒ–æ¯ä¸€å±‚
   - å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´
   - ç”Ÿæˆåçš„ .trt æ–‡ä»¶å¯ä»¥é‡å¤ä½¿ç”¨

================================================================================
                    ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥
================================================================================

é—®é¢˜ 1: ONNX å¯¼å‡ºå¤±è´¥ "grid_sampler not supported"
è§£å†³: ç¡®ä¿ model_shift.py ä¸­ä½¿ç”¨ opset=16

é—®é¢˜ 2: TensorRT è½¬æ¢æ—¶æŠ¥ "plugin not found"
è§£å†³: æ£€æŸ¥æ’ä»¶æ˜¯å¦æ­£ç¡®åŠ è½½ï¼ˆçœ‹æ—¥å¿—ç¬¬ä¸€è¡Œï¼‰

é—®é¢˜ 3: TensorRT è½¬æ¢å¾ˆæ…¢
è§£å†³: æ­£å¸¸ç°è±¡ï¼Œç¬¬ä¸€æ¬¡è½¬æ¢éœ€è¦ä¼˜åŒ–ï¼Œè€å¿ƒç­‰å¾…

é—®é¢˜ 4: è¿è¡Œæ—¶æŠ¥ "cannot deserialize plugin"
è§£å†³: 
- æ£€æŸ¥ .trt å¼•æ“æ˜¯å¦æ˜¯ç”¨ MDB-YOLO.onnx ç”Ÿæˆçš„
- ä¸è¦ä½¿ç”¨æ—§çš„ bestfp16.trt

================================================================================
                    ğŸ“Š æ€§èƒ½å¯¹æ¯”
================================================================================

å»ºè®®æµ‹è¯•ä¸åŒç²¾åº¦çš„æ€§èƒ½:
- FP32: ç²¾åº¦æœ€é«˜ï¼Œé€Ÿåº¦è¾ƒæ…¢
- FP16: ç²¾åº¦ç•¥é™ï¼ˆé€šå¸¸ < 1%ï¼‰ï¼Œé€Ÿåº¦æå‡ 2-3x
- INT8: ç²¾åº¦é™ä½è¾ƒå¤šï¼Œé€Ÿåº¦æœ€å¿«ï¼ˆéœ€è¦æ ¡å‡†æ•°æ®é›†ï¼‰

æ¨èä½¿ç”¨ FP16 ä½œä¸ºéƒ¨ç½²ç‰ˆæœ¬

================================================================================




